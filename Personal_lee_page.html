<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!--Bootstrap CSS-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!--Bootstrap Icons-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
        .gridecard {
            height: 100px;
            margin-top: 10px;
            margin-bottom: 50px;
            object-fit: cover;
        }

        .porofile>button {
            margin-top: 50px;
            display: flex;
            justify-content: center;
            align-items: center;

            background-color: transparent;
            color: #0c70f2;
            border: 1px solid #0c70f2;
            border-radius: 6px;

        }

    

        .comment {
            margin-top: 100px;
        }
    </style>
   <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import {
    getFirestore, collection, addDoc, serverTimestamp,
    onSnapshot, query, orderBy, deleteDoc, doc
  } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

  // Firebase 설정 (그대로 사용)
  const firebaseConfig = {
    apiKey: "AIzaSyBZXOom0v2LEhvbXIIK6Oki0nf2AxjNBak",
    authDomain: "sparta-f7298.firebaseapp.com",
    projectId: "sparta-f7298",
    storageBucket: "sparta-f7298.firebasestorage.app",
    messagingSenderId: "247754609087",
    appId: "1:247754609087:web:9a5a00387300433764910a",
    measurementId: "G-LC7M2S9DJK"
  };

  // 초기화
  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);

  // jQuery DOM 준비
  $(function () {
    const $textarea = $("#floatingTextarea2"); 
    const $button   = $("#commentBtn");
    const $list     = $("#commentList");
    const colRef    = collection(db, "comment");

    // 댓글 저장 (DB에 저장만 하고, 화면 반영은 onSnapshot이 담당)
    $button.on("click", async function () {
      const text = $textarea.val().trim();
      if (!text) {
        alert("댓글을 입력하세요!");
        $textarea.focus();
        return;
      }
      try {
        await addDoc(colRef, {
          content: text,
          createdAt: serverTimestamp()
        });
        $textarea.val("").focus();
      } catch (err) {
        console.error("저장 오류:", err);
        alert("저장 실패: " + err.message);
      }
    });

    // Ctrl+Enter 등록
    $textarea.on("keydown", function (e) {
      if (e.ctrlKey && e.key === "Enter") {
        e.preventDefault();
        $button.click();
      }
    });

    // 실시간 목록 렌더링 (최신순)
    const q = query(colRef, orderBy("createdAt", "desc"));
    onSnapshot(q, (snap) => {
      $list.empty();
      snap.forEach(d => {
        const data = d.data();
        const id   = d.id;

        const $li = $(`
          <li class="list-group-item d-flex justify-content-between align-items-center" data-id="${id}">
            <span>${data.content || ""}</span>
            <button class="btn btn-sm btn-danger deleteBtn">삭제</button>
          </li>
        `);
        $list.append($li);
      });
    });

    // 삭제 (DB 문서도 함께 삭제)
    $list.on("click", ".deleteBtn", async function () {
      const id = $(this).closest("li").data("id");
      if (!id) return;
      if (!confirm("정말 삭제하시겠습니까?")) return;
      try {
        await deleteDoc(doc(db, "comment", id));
      } catch (err) {
        console.error("삭제 오류:", err);
        alert("삭제 실패: " + err.message);
      }
    });
  });
</script>


</head>

<body>
    <div class="container">
        <!--상단-->
        <div>
            <header class="d-flex justify-content-center py-3">
                <ul class="nav nav-pills">
                    <li class="nav-item"><a href="#" class="nav-link active" aria-current="page">청운 프로필</a></li>
                    
                </ul>
            </header>
        </div>
        <div class="porofile">
            <p>
            <h1>안녕하세요!</h1>
            </p>
            <p>
            <h1>만나서 반갑습니다!</h1>
            </p>

            <!-- <button id="recordBtn">기록하기</button> -->
            <!-- <button id="registrationBtn">등록하기</button> -->
        </div>


        <!--플로팅 라벨-->
        <!-- <div class="flotingbox" id="fbox">
            <div class="form-floating mb-3">
                <input type="email" class="form-control" id="image" placeholder="name@example.com">
                <label for="floatingInput">image</label>
            </div>
            <div class="form-floating mb-3">
                <input type="email" class="form-control" id="title" placeholder="name@example.com">
                <label for="floatingInput">title</label>
            </div>
            <div class="form-floating mb-3">
                <input type="email" class="form-control" id="story" placeholder="name@example.com">
                <label for="floatingInput">story</label>
            </div>
        </div> -->


        <!--그리드 카드-->
        <div class="gridecard">
            <div class="row row-cols-1 row-cols-md-2 g-4">
                <div class="col">
                    <div class="card h-100">

                        <img src="file:///Users/icheong-un/Downloads/IMG_3759.jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title">인사말</h5>
                            <p class="card-text">안녕하세요! 저는 체육을 전공했던 이청운입니다. 원래 사진을 잘 안찍어 운동 사진 밖에 없습니다
                                부족한 부분이 많지만 열심히 하겠습니다! 앞으로 잘 부탁드려요 감사합니다!
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card h-100">
                        <img src="/Users/icheong-un/Downloads/487 2.jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title">자기소개</h5>
                            <p class="card-text">이청운</p>
                            <p class="card-text">출생년도: 98년생 만26.9살</p>
                            <p class="card-text">MBTI: ISFP</p>
                            <p class="card-text">취미: 운동/여행</p>
                        </div>
                    </div>
                </div>
                


        </div>


        <!--댓글 입력칸-->
        <div id="fbox" class="comment">
            <!--(채팅창)플러시-->
            <div>
                <ul class="list-group list-group-flush" id="commentList">
                    <li class="list-group-item">방명록</li>
                </ul>



                <!--댓글 창-->
                <div class="input-group mb-3">
                    <div class="form-floating flex-grow-1">
                        <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea2"
                            style="height: 100px"></textarea>
                        <label for="floatingTextarea2">댓글 작성하기</label>
                    </div>
                    <button class="btn btn-outline-secondary" type="button" id="commentBtn">완료</button>
                </div>
            </div>
        </div>

        <!-- 하단 -->

</body>

</html>